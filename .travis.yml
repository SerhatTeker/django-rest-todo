sudo: required

language: python
python:
  - "3.8"

services:
  - docker

before_script:
  - docker-compose build

script:
  - docker-compose run --rm web bash -c "python wait_for_postgres.py &&
                                         coverage erase &&
                                         coverage run -m pytest &&
                                         coverage report -m &&
                                         coverage html"

# push results to CodeCov
after_success:
  - bash <(curl -s https://codecov.io/bash)

# Don't email me the results of the test runs
notifications:
  email: false

cache:
  pip: true
