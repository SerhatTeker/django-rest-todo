sudo: required

language: python
python:
  - "3.8"

services:
  - docker

before_script:
  - docker-compose build

script:
  # Codecov testing with pytest
  # https://docs.codecov.io/docs/python#testing-with-pytest
  - docker-compose run --rm web bash -c "python wait_for_postgres.py &&
                                         pytest --cov-report=xml --cov=./ tests/"

# Push results to Codecov.io
after_success:
  - bash <(curl -s https://codecov.io/bash)

# Don't email me the results of the test runs
notifications:
  email: false

# Use pip cache
cache:
  pip: true
